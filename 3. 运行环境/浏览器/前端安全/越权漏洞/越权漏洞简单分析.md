# [越权漏洞简单分析](https://blog.csdn.net/lyc1401070320/article/details/83410065)

## 原理

越权漏洞是Web安全程序中的一种常见漏洞，威胁在于一个账户可以控制全站用户数据。成因主要是开发人员对于数据的增删改以及查询时候过于信任客户端请求的数据，而遗漏了权限的判定。

## 分类

主要分为水平越权和垂直越权。

1. 水平越权

    主要指的是攻击者尝试访问和自己账户相同权限的用户资源，比如一个写作网站，写手A可以对自己的文章进行发布、查看、删除等操作，删除的URL如下所示：

    ```http://www.xxxx.com/article.php?action=delete&id=1```

    上面的id为文章号，表示要对id为1的文章删除，如果A用户想要攻击其他的数据，将id改为2时，将会把id为2的文章删除，而2并不是A的文章，这样就产生了水平越权。

2. 垂直越权

    分为两种，向上越权和向下越权；

    向上指的是一个低级别攻击者尝试访问高级别用户的资源，向下指一个高级别用户尝试访问低级别用户的资源；

## 越权产生条件

1. 隐藏URL

    实现控制访问有些程序的管理员管理页面只有管理员才显示，普通用户看不到，利用URL实现访问控制，但是一旦URL泄漏或被恶意攻击者猜到后，便会产生越权；

2. 直接对象引用

    也就是简单修改一下参数便可产生越权，例如查看用户页面URL后加上自己的id便可查看，当修改为他人的id之后会返回他人的信息，这里产生了水平越权；

3. 多阶段功能

    指的是一个业务流程有多个阶段，开发时只考虑了某一个阶段的鉴权，而在后面的阶段不再考虑鉴权问题，导致恶意攻击者可以直接抓包修改参数值，产生恶意攻击；

4. 静态文件

    很多网站的下载功能，只有会员可以下载，但是这些文件的URL泄漏之后，任何人可以下载，甚至如果知道了文件的命名规则，就可以对网站的所有文件进行批量下载；

5. 平台配置错误

    由于配置平台或者配置控件错误时，会导致权限的错误；

## 如何查找越权漏洞

在和服务端进行数据交互时客户端携带着用户标识的cookie，当服务端的session和cookie匹配成功后，才能允许用户进行相关操作；除了cookie之外，可能在参数中还会存在一些标识身份的字段；

* 请求中不存在参数，只有cookie进行身份验证，无法水平越权，可能垂直越权；
* 请求中存在参数，并且参数中存在可能是辨别信息的唯一值，可能存在水平越权和垂直越权；

## 如何修复漏洞

1. 查看用户信息等类似请求，不能只根据用户id去搜索，应该再次进行身份验证；
2. 可以从用户的加密cookie中获取用户id，防止攻击者对其修改；或者cookie中加入不可预测、不可拆解的user信息；
3. 在每个页面加载前进行认证；
4. 特别敏感操作可以让用户再次数据密码；
