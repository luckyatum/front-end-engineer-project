# [ssrf](https://www.jianshu.com/p/d1d1c40f6d4c)

## SSRF漏洞是什么

SSRF，是一种由攻击者构造形成由服务端发起请求的一个安全漏洞；SSRF的首要目标是内部系统；

## SSRF是怎么形成的

大都是因为服务端提供了从其他服务器应用获取数据的功能，且没有对目标地址做过滤与限制；比如从指定地址获取网页文本内容，加载指定地址的图片等；

假设当前存在网站A，其内网是B，网站A是所有人都可以访问的，而B则只有内部能访问；

而攻击者目的就是通过网站A作为中间人达到攻击网站B；

正常用户访问网站A的流程：

    输入A网站URL->发送请求->A服务器接受请求并处理->返回响应；

假设网站存在一个请求：http://www.baidu.com/xxx.php?image=URL，由于服务端没有对image做限制和过滤，导致A网站可以从其他服务器获取数据；

此时我们将image参数改成：image=www.neiwang.com，如果存在该内网，将会返回请求成功的结果；

所以，SSRF就是通过篡改获取资源的请求发送给服务器，一旦服务器没有检测这个请求的合法性，就会被利用来访问其他服务器或者内部服务器的资源；

## SSRF可以做什么

* 内外网的端口扫描；
* 主机本地敏感信息获取；
* 内外网主机应用程序漏洞利用；
* 内外网Web站点漏洞的利用；
* ...

## SSRF漏洞的寻找

注：几乎所有的调外部资源的请求都可能存在ssrf漏洞；

* 分享：通过url地址分享网页内容；
* 转码服务；
* 在线翻译；
* 图片加载与下载；
* 图片、文章收藏功能；

## SSRF漏洞的验证方法

1. 可以通过抓包分析请求是否由服务器发送的；
2. 在页面源码中查找访问的资源地址，检查可能存在访问其他服务的链接；

## SSRG的防护

1. 是否可以直接禁止内网的ip地址？

    答案是不可以，因为即时对所有的内网ip配置了黑名单，只要能拿到数字地址，同样是可以访问到内网服务器，因此单纯的针对ip地址的限制是没效果的；
2. 研发需要考虑以下的问题：

    * 确认用户是否可控
        如果发起请求的域名不是由用户填写的，那么直接配置域名白名单即可，只能对白名单里面的域名发起请求；
        如果发起请求的域名是由用户填写，且是公网应用，那么不允许配置白名单，否则容易造成服务器入侵；
        如果发起请求的域名是由用户填写，且是办公网络，那么可以配置白名单，但是要进行严格的权限控制，以及打印访问日志；
    * 黑白名单需要注意
        进行域名白名单匹配，进行公司ip网段黑名单匹配；
    * 注意使用的协议
        使用http/https协议，禁止使用其他敏感协议，如：ftp/file/ssh等
